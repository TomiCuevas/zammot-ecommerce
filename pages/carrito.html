<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAMMOT - Carrito</title>

    <link rel="icon" type="image/webp" href="../styles/img/zammot_bowtie.webp">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="../styles/css/destacados.css">
    <link rel="stylesheet" href="../styles/css/styless.css">
    <script src="../js/dataPages.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/navbar.js"></script>
    <script src="../js/carrito.js"></script>
    <script src="../js/renderProducts.js"></script>
</head>

<body class="bg-dark text-light">
    <div id="navbar"></div>
    <script>renderNavbar();</script>

    <div class="container my-5">

        <h2 class="mb-4">ðŸ›’ Tu Carrito</h2>
        <div id="cart-items" class="mb-4"></div>
        <h3>Total: $<span id="cart-total">0</span></h3>

        <div class="text-center mt-4 mb-3">
            <button class="btn btn-success btn-lg d-flex align-items-center justify-content-center gap-2 mx-auto"
                    onclick="pagar()">
                <i class="bi bi-cash-stack"></i> Pagar ahora
            </button>
        </div>

        <div class="text-center">
            <button class="btn btn-outline-danger d-flex align-items-center justify-content-center mx-auto gap-2"
                    onclick="vaciarCarrito()">
                <i class="bi bi-trash"></i> Vaciar carrito
            </button>
        </div>

    </div>

    <script>

        function renderCart() {

            const cart = loadCart(); // leer carrito del localStorage
            const container = document.getElementById("cart-items");

            // Si estÃ¡ vacÃ­o
            if (cart.length === 0) {
                container.innerHTML = "<p>No hay productos en el carrito.</p>";
                document.getElementById("cart-total").textContent = 0;
                return;
            }

            // Si todavÃ­a NO cargamos productos.json â†’ FETCH
            if (PRODUCTS_CACHE.length === 0) {
                loadProducts().then(renderCart);
                return;
            }
    
            let html = "";
            let total = 0;

            cart.forEach(item => {

                const product = PRODUCTS_CACHE.find(p => p.id === item.id);
                if (!product) return;

                const subtotal = product.price * item.qty;
                total += subtotal;

                html += `
                    <div class="card bg-secondary mb-3 p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5>${product.title}</h5>
                                <p>Cantidad: ${item.qty}</p>
                                <p>Precio unitario: $${product.price}</p>
                                <h6>Subtotal: $${subtotal}</h6>
                            </div>

                            <!-- botÃ³n eliminar producto -->
                            <button class="btn btn-danger btn-sm"
                                    onclick="removeFromCart('${product.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            document.getElementById("cart-total").textContent = total;
        }

        renderCart();


        function pagar() {

            const cart = loadCart();

            if (cart.length === 0) {
                alert("No hay productos en el carrito.");
                return;
            }

            clearCart();        // vaciar localStorage
            updateCartCount(); 
            renderCart();       

            alert("Â¡Pago realizado con Ã©xito! Gracias por tu compra");

            window.location.href = "./home.html";
        }


        function vaciarCarrito() {

            const cart = loadCart();

            if (cart.length === 0) {
                alert("El carrito ya estÃ¡ vacÃ­o.");
                return;
            }

            if (!confirm("Â¿Seguro que deseas vaciar el carrito?")) return;

            clearCart();   
            updateCartCount();
            renderCart();      

            alert("Carrito vaciado correctamente.");
        }

    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
